import * as React from 'react'
import { act, render } from '@testing-library/react'
import Form from '../../Form'
import Agreemnets from '../index'

describe('base <Agreemnets />', () => {
  const onSubmit = jest.fn()
  const linksForReplace = {
    TEST_URL: 'https://test.local/test',
  }
  const setupWrapper = ({
    formId = 'testForm',
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
  }): any => {
    const wrapper = render(
      <Form id={formId} onSubmit={onSubmit}>
        <Agreemnets linksForReplace={linksForReplace} />
      </Form>
    )
    const { container } = wrapper

    const agreements = container.querySelector('[name="agreements.selectAll"]')

    return {
      ...wrapper,
      agreements,
    }
  }

  beforeEach(async () => {
    const mockFetchData = [
      {
        id: 1,
        content: 'test test test TEST_URL',
        required: true,
      },
    ]
    const mockFetchJsonPromise = Promise.resolve(mockFetchData)
    const mockFetch = Promise.resolve({
      json: () => mockFetchJsonPromise,
    })
    jest.spyOn(global, 'fetch').mockImplementation(() => mockFetch)
  })

  afterEach(() => {
    jest.clearAllMocks()
  })

  it('matches snapshot', () => {
    const wrapper = setupWrapper({})
    const { container, agreements } = wrapper

    expect(container).toBe('abc')
    expect(wrapper).toMatchSnapshot()
  })
})
